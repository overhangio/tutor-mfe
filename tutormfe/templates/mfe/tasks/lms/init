# MFE-specific tasks
./manage.py lms waffle_flag --list > /tmp/lms_waffle_flags.txt

{% if is_mfe_enabled("account") %}
grep account.redirect_to_microfrontend /tmp/lms_waffle_flags.txt || ./manage.py lms waffle_flag --create --everyone account.redirect_to_microfrontend
./manage.py lms populate_retirement_states
{% else %}
./manage.py lms waffle_delete --flags account.redirect_to_microfrontend
{% endif %}

{% if is_mfe_enabled("profile") %}
grep learner_profile.redirect_to_microfrontend /tmp/lms_waffle_flags.txt || ./manage.py lms waffle_flag --create --everyone learner_profile.redirect_to_microfrontend
site-configuration set --domain={{ LMS_HOST }} ENABLE_PROFILE_MICROFRONTEND true
site-configuration set --domain={{ LMS_HOST }}:8000 ENABLE_PROFILE_MICROFRONTEND true
{% else %}
site-configuration unset --domain={{ LMS_HOST }} ENABLE_PROFILE_MICROFRONTEND
site-configuration unset --domain={{ LMS_HOST }}:8000 ENABLE_PROFILE_MICROFRONTEND
./manage.py lms waffle_delete --flags learner_profile.redirect_to_microfrontend
{% endif %}

{% if is_mfe_enabled("learner-dashboard") %}
grep learner_home_mfe.enabled /tmp/lms_waffle_flags.txt || ./manage.py lms waffle_flag --create --everyone learner_home_mfe.enabled
{% else %}
./manage.py lms waffle_delete --flags learner_home_mfe.enabled
{% endif %}

{% if is_mfe_enabled("learning") %}
grep course_home.course_home_mfe_progress_tab /tmp/lms_waffle_flags.txt || ./manage.py lms waffle_flag --create --everyone course_home.course_home_mfe_progress_tab
grep courseware.enable_navigation_sidebar /tmp/lms_waffle_flags.txt || ./manage.py lms waffle_flag --create --everyone courseware.enable_navigation_sidebar
grep courseware.always_open_auxiliary_sidebar /tmp/lms_waffle_flags.txt || ./manage.py lms waffle_flag --create --deactivate courseware.always_open_auxiliary_sidebar
{% else %}
./manage.py lms waffle_delete --flags \
    course_home.course_home_mfe_progress_tab \
    courseware.enable_navigation_sidebar \
    courseware.always_open_auxiliary_sidebar
{% endif %}

{% if is_mfe_enabled("authoring") %}
grep discussions.pages_and_resources_mfe /tmp/lms_waffle_flags.txt || ./manage.py lms waffle_flag --create --everyone discussions.pages_and_resources_mfe
grep new_studio_mfe.use_tagging_taxonomy_list_page /tmp/lms_waffle_flags.txt || ./manage.py lms waffle_flag --create --everyone new_studio_mfe.use_tagging_taxonomy_list_page
./manage.py lms waffle_delete --flags \
    legacy_studio.advanced_settings \
    legacy_studio.certificates \
    legacy_studio.course_outline \
    legacy_studio.course_team \
    legacy_studio.custom_pages \
    legacy_studio.export \
    legacy_studio.files_uploads \
    legacy_studio.grading \
    legacy_studio.group_configurations \
    legacy_studio.import \
    legacy_studio.schedule_details \
    legacy_studio.textbooks \
    legacy_studio.updates \
    legacy_studio.problem_editor \
    legacy_studio.text_editor \
    legacy_studio.video_editor \
    legacy_studio.logged_out_home \
    legacy_studio.home
{% else %}
grep new_studio_mfe.use_new_home_page /tmp/lms_waffle_flags.txt || ./manage.py lms waffle_flag --create --everyone new_studio_mfe.use_new_home_page
grep legacy_studio.advanced_settings /tmp/lms_waffle_flags.txt || ./manage.py lms waffle_flag --create --everyone legacy_studio.advanced_settings
grep legacy_studio.certificates /tmp/lms_waffle_flags.txt || ./manage.py lms waffle_flag --create --everyone legacy_studio.certificates
grep legacy_studio.course_outline /tmp/lms_waffle_flags.txt || ./manage.py lms waffle_flag --create --everyone legacy_studio.course_outline
grep legacy_studio.course_team /tmp/lms_waffle_flags.txt || ./manage.py lms waffle_flag --create --everyone legacy_studio.course_team
grep legacy_studio.custom_pages /tmp/lms_waffle_flags.txt || ./manage.py lms waffle_flag --create --everyone legacy_studio.custom_pages
grep legacy_studio.export /tmp/lms_waffle_flags.txt || ./manage.py lms waffle_flag --create --everyone legacy_studio.export
grep legacy_studio.files_uploads /tmp/lms_waffle_flags.txt || ./manage.py lms waffle_flag --create --everyone legacy_studio.files_uploads
grep legacy_studio.grading /tmp/lms_waffle_flags.txt || ./manage.py lms waffle_flag --create --everyone legacy_studio.grading
grep legacy_studio.group_configurations /tmp/lms_waffle_flags.txt || ./manage.py lms waffle_flag --create --everyone legacy_studio.group_configurations
grep legacy_studio.import /tmp/lms_waffle_flags.txt || ./manage.py lms waffle_flag --create --everyone legacy_studio.import
grep legacy_studio.schedule_details /tmp/lms_waffle_flags.txt || ./manage.py lms waffle_flag --create --everyone legacy_studio.schedule_details
grep legacy_studio.textbooks /tmp/lms_waffle_flags.txt || ./manage.py lms waffle_flag --create --everyone legacy_studio.textbooks
grep legacy_studio.updates /tmp/lms_waffle_flags.txt || ./manage.py lms waffle_flag --create --everyone legacy_studio.updates
grep legacy_studio.problem_editor /tmp/lms_waffle_flags.txt || ./manage.py lms waffle_flag --create --everyone legacy_studio.problem_editor
grep legacy_studio.text_editor /tmp/lms_waffle_flags.txt || ./manage.py lms waffle_flag --create --everyone legacy_studio.text_editor
grep legacy_studio.video_editor /tmp/lms_waffle_flags.txt || ./manage.py lms waffle_flag --create --everyone legacy_studio.video_editor
grep legacy_studio.home /tmp/lms_waffle_flags.txt || ./manage.py lms waffle_flag --create --everyone legacy_studio.home
grep legacy_studio.logged_out_home /tmp/lms_waffle_flags.txt || ./manage.py lms waffle_flag --create --everyone legacy_studio.logged_out_home
./manage.py lms waffle_delete --flags \
    discussions.pages_and_resources_mfe \
    new_studio_mfe.use_tagging_taxonomy_list_page
{% endif %}

{% if is_mfe_enabled("discussions") %}
grep discussions.enable_discussions_mfe  /tmp/lms_waffle_flags.txt || ./manage.py lms waffle_flag --create --everyone discussions.enable_discussions_mfe
grep discussions.enable_learners_tab_in_discussions_mfe  /tmp/lms_waffle_flags.txt || ./manage.py lms waffle_flag --create --everyone discussions.enable_learners_tab_in_discussions_mfe
grep discussions.enable_moderation_reason_codes  /tmp/lms_waffle_flags.txt || ./manage.py lms waffle_flag --create --everyone discussions.enable_moderation_reason_codes
grep discussions.enable_reported_content_email_notifications  /tmp/lms_waffle_flags.txt || ./manage.py lms waffle_flag --create --everyone discussions.enable_reported_content_email_notifications
grep discussions.enable_learners_stats  /tmp/lms_waffle_flags.txt || ./manage.py lms waffle_flag --create --everyone discussions.enable_learners_stats
grep discussions.enable_new_structure_discussions  /tmp/lms_waffle_flags.txt || ./manage.py lms waffle_flag --create --everyone discussions.enable_new_structure_discussions
{% else %}
./manage.py lms waffle_delete --flags \
    discussions.enable_discussions_mfe \
    discussions.enable_learners_tab_in_discussions_mfe \
    discussions.enable_moderation_reason_codes \
    discussions.enable_reported_content_email_notifications \
    discussions.enable_learners_stats \
    discussions.enable_new_structure_discussions
{% endif %}

{% if is_mfe_enabled("ora-grading") %}
grep openresponseassessment.enhanced_staff_grader /tmp/lms_waffle_flags.txt || ./manage.py lms waffle_flag --create --everyone openresponseassessment.enhanced_staff_grader
{% else %}
./manage.py lms waffle_delete --flags openresponseassessment.enhanced_staff_grader
{% endif %}
